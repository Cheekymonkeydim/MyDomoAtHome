language: perl
perl:
  - "5.20"
  - "5.18"
  - "5.14"
before_install:
  - eval $(curl https://travis-perl.github.io/init) --auto
  - sudo apt-get update -qq
  - sudo apt-get install libdancer-perl libswitch-perl libfile-slurp-perl liblwp-protocol-psgi-perl cpanminus
  - sudo apt-get install libjson-perl libplack-perl libcrypt-ssleay-perl 
  - sudo apt-get install libaudio-mpd-perl libnet-upnp-perl libpoe-component-client-mpd-perl
  - cpanm Time::Piece
  - sudo apt-get install starman
  #- curl -L http://cpanmin.us | perl - --sudo Dancer2
  - perlbrew install-cpanm -f
  - cpanm Test::Pod # optional dependency
  #Safe fails to install due to failing tests since version 2.35 on perl < 5.14
  - perl -E 'exit($] < 5.014)' || cpanm --no-skip-satisfied Safe || cpanm --no-skip-satisfied --notest Safe || { cat ~/.cpanm/build.log ; false ; }
  #Moo fails to install without Class::Method::Modifiers since 2012/10/19 
  - cpanm --no-skip-satisfied Class::Method::Modifiers YAML::XS || { cat ~/.cpanm/build.log ; false ; }
  - dzil authordeps --missing | cpanm --no-skip-satisfied || { cat ~/.cpanm/build.log ; false ; }
  - dzil listdeps --author --missing | cpanm --no-skip-satisfied || { cat ~/.cpanm/build.log ; false ; }
install:
  - cpanm -nq --installdeps --with-recommends --with-suggests .
    #- cpanm -v --installdeps --notest --mirror http://cpan.mirrors.travis-ci.org 
env: RELEASE_TESTING=1 AUTOMATED_TESTING=1
script: 
  "./MyDomoAtHome/start2.sh"
# branches:
#   only:
#     - master
notifications:
  recipients:
    - domoticz@e-nef.com
  template:
      - "%{branch}#%{build_number} by %{author}: %{message} (%{build_url})"
    on_success: change
    on_failure: always
    use_notice: true
